<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pok√©mon Card Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 40px 20px;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
}

header {
  text-align: center;
  color: white;
  margin-bottom: 40px;
}

header h1 {
  font-size: 3em;
  margin-bottom: 8px;
  font-weight: 700;
  text-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

header p {
  font-size: 1.1em;
  opacity: 0.95;
}

.card {
  background: white;
  border-radius: 16px;
  padding: 30px;
  margin-bottom: 24px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 25px 70px rgba(0,0,0,0.35);
}

.controls {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  align-items: center;
  margin-bottom: 20px;
}

.btn {
  padding: 12px 24px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  font-size: 1em;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
}

.btn-success {
  background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
  color: white;
}

.btn-success:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(56, 239, 125, 0.4);
}

.btn-secondary {
  background: #f3f4f6;
  color: #1f2937;
}

.btn-secondary:hover {
  background: #e5e7eb;
  transform: translateY(-2px);
}

#cardCount {
  margin-left: auto;
  font-weight: 600;
  color: #667eea;
  font-size: 1em;
}

.filters-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 16px;
  margin-bottom: 20px;
}

.filter-group {
  display: flex;
  flex-direction: column;
}

.filter-group label {
  font-size: 0.85em;
  font-weight: 600;
  color: #4b5563;
  margin-bottom: 8px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.filter-group input,
.filter-group select {
  padding: 12px 14px;
  border: 2px solid #e5e7eb;
  border-radius: 10px;
  font-size: 1em;
  transition: all 0.3s ease;
  font-family: inherit;
}

.filter-group input:focus,
.filter-group select:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  background-color: #f9fafb;
}

.sort-controls {
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}

.sort-btn {
  padding: 10px 16px;
  background: #f3f4f6;
  border: 2px solid #e5e7eb;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  font-size: 0.95em;
}

.sort-btn:hover {
  background: #e5e7eb;
  border-color: #667eea;
}

.sort-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-color: transparent;
}

.table-wrapper {
  overflow-x: auto;
  border-radius: 12px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

thead {
  background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
}

th {
  padding: 16px;
  text-align: left;
  font-weight: 700;
  color: #1f2937;
  font-size: 0.95em;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 2px solid #e5e7eb;
}

td {
  padding: 16px;
  border-bottom: 1px solid #f3f4f6;
  color: #374151;
}

tbody tr {
  transition: all 0.2s ease;
}

tbody tr:hover {
  background: linear-gradient(90deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
}

tbody tr:last-child td {
  border-bottom: none;
}

.badge {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 6px 12px;
  border-radius: 20px;
  font-weight: 600;
  font-size: 0.9em;
  display: inline-block;
}

.empty {
  text-align: center;
  color: #9ca3af;
  padding: 60px 20px;
  font-size: 1.1em;
}

input[type="file"] {
  display: none;
}

@media (max-width: 768px) {
  header h1 {
    font-size: 2em;
  }

  .controls {
    flex-direction: column;
  }

  .controls .btn {
    width: 100%;
    justify-content: center;
  }

  #cardCount {
    margin-left: 0;
    width: 100%;
    text-align: center;
  }

  .filters-grid {
    grid-template-columns: 1fr;
  }

  .sort-controls {
    width: 100%;
  }

  table {
    font-size: 0.9em;
  }

  th, td {
    padding: 12px;
  }
}
</style>
</head>

<body>
<div class="container">

<header>
  <h1>üé¥ Pok√©mon Card Tracker</h1>
  <p>Manage and analyze your card collection</p>
</header>

<div class="card">
  <div class="controls">
    <label class="btn btn-primary">
      üì§ Upload CSV
      <input type="file" id="csvFile" accept=".csv">
    </label>
    <button class="btn btn-success" onclick="exportCSV()">üì• Export CSV</button>
    <span id="cardCount">0 cards loaded</span>
  </div>
</div>

<div class="card">
  <div class="filters-grid">
    <div class="filter-group">
      <label>üîç Search Card</label>
      <input id="search" placeholder="Card name..." oninput="applyFilters()">
    </div>
    <div class="filter-group">
      <label>üí∞ Min Price</label>
      <input id="minPrice" type="number" placeholder="0" oninput="applyFilters()">
    </div>
    <div class="filter-group">
      <label>üí∞ Max Price</label>
      <input id="maxPrice" type="number" placeholder="No limit" oninput="applyFilters()">
    </div>
    <div class="filter-group">
      <label>üìä Sort By</label>
      <select id="sortBy" onchange="applyFilters()">
        <option value="name">Name</option>
        <option value="price">Price</option>
        <option value="ratio">Ratio</option>
      </select>
    </div>
  </div>
  <div class="sort-controls">
    <button class="sort-btn active" id="sortBtn" onclick="toggleSort()">‚Üë Ascending</button>
  </div>
</div>

<div class="card">
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Card Name</th>
          <th>Price</th>
          <th>PSA 9</th>
          <th>PSA 10</th>
          <th>Ratio</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr><td colspan="5" class="empty">Upload a CSV file to get started</td></tr>
      </tbody>
    </table>
  </div>
</div>

</div>

<script>
let cards = [];
let filtered = [];
let sortAsc = true;

const normalize = s => s.toLowerCase().replace(/[^a-z0-9]/g, '');

document.getElementById('csvFile').addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = ev => {
    try {
      const text = ev.target.result.trim();
      const delimiter = text.includes('\t') ? '\t' : ',';
      const lines = text.split('\n').filter(Boolean);

      const headers = lines[0].split(delimiter).map(h => normalize(h));

      const idx = name => headers.indexOf(name);

      cards = lines.slice(1).map(line => {
        const v = line.split(delimiter).map(x => x.trim());
        return {
          name: v[idx('cardname')] || '',
          price: parseFloat(v[idx('rawprice')] || 0),
          psa9: parseFloat(v[idx('psa9price')] || 0),
          psa10: parseFloat(v[idx('psa10price')] || 0),
          ratio: parseFloat(v[idx('ratio')] || 0)
        };
      }).filter(c => c.name);

      if (cards.length === 0) {
        alert('CSV loaded but no cards were found. Check headers.');
        return;
      }

      localStorage.setItem('cards', JSON.stringify(cards));
      document.getElementById('cardCount').textContent = cards.length + ' cards loaded';
      applyFilters();

    } catch (err) {
      alert('Error parsing CSV');
      console.error(err);
    }
  };

  reader.readAsText(file);
});

function applyFilters() {
  const search = document.getElementById('search').value.toLowerCase();
  const min = parseFloat(document.getElementById('minPrice').value) || 0;
  const max = parseFloat(document.getElementById('maxPrice').value) || Infinity;
  const sort = document.getElementById('sortBy').value;

  // FILTER (NaN-safe)
  filtered = cards.filter(c => {
    const price = Number(c.price);
    const safePrice = Number.isFinite(price) ? price : 0;

    return (
      c.name.toLowerCase().includes(search) &&
      safePrice >= min &&
      safePrice <= max
    );
  });

  // SORT (must be OUTSIDE filter)
  filtered.sort((a, b) => {
    const A = sort === 'name' ? a.name : a[sort];
    const B = sort === 'name' ? b.name : b[sort];
    return sortAsc ? (A > B ? 1 : -1) : (A < B ? 1 : -1);
  });

  render();
}

function toggleSort() {
  sortAsc = !sortAsc;
  document.getElementById('sortBtn').textContent = sortAsc ? '‚Üë Ascending' : '‚Üì Descending';
  applyFilters();
}

function render() {
  const body = document.getElementById('tableBody');
  if (!filtered.length) {
    body.innerHTML = `<tr><td colspan="5" class="empty">No cards found</td></tr>`;
    return;
  }

  body.innerHTML = filtered.map(c => `
    <tr>
      <td><strong>${c.name}</strong></td>
      <td>$${c.price.toFixed(2)}</td>
      <td>$${c.psa9.toFixed(2)}</td>
      <td>$${c.psa10.toFixed(2)}</td>
      <td><span class="badge">${c.ratio.toFixed(2)}</span></td>
    </tr>
  `).join('');
}

function exportCSV() {
  if (!cards.length) return alert('No cards to export');
  const rows = [
    'Card Name,Raw Price,PSA 9,PSA 10,Ratio',
    ...cards.map(c =>
      `${c.name},${c.price},${c.psa9},${c.psa10},${c.ratio}`
    )
  ].join('\n');

  const blob = new Blob([rows], { type: 'text/csv' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'pokemon_cards.csv';
  a.click();
}

// load saved data
const saved = localStorage.getItem('cards');
if (saved) {
  cards = JSON.parse(saved).map(c => ({
    ...c,
    price: Number.isFinite(Number(c.price)) ? Number(c.price) : 0,
    psa9: Number.isFinite(Number(c.psa9)) ? Number(c.psa9) : 0,
    psa10: Number.isFinite(Number(c.psa10)) ? Number(c.psa10) : 0,
    ratio: Number.isFinite(Number(c.ratio)) ? Number(c.ratio) : 0
  }));

  document.getElementById('cardCount').textContent =
    cards.length + ' cards loaded';

  applyFilters();
}
</script>
</body>

</html>
